generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model UserRole {
  id   Int    @id @default(autoincrement())
  name String @unique
  user User[]
}

model User {
  id           Int           @id @default(autoincrement())
  firstName    String
  lastName     String
  email        String        @unique
  passwordHash String
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  roleId       Int
  lastLoginAt  DateTime?
  activities   Activity[]
  adminActions AdminAction[]
  attendances  Attendance[]
  role         UserRole      @relation(fields: [roleId], references: [id])
  wfhRequests  WfhRequest[] @relation("WfhRequests")
  wfhDecisions WfhRequest[] @relation("WfhDecisions")

}

model AttendanceStatus {
  id          Int          @id @default(autoincrement())
  name        String       @unique
  attendances Attendance[]
}

model Attendance {
  id               Int              @id @default(autoincrement())
  date             DateTime
  startTime        DateTime?
  endTime          DateTime?
  totalWorkMinutes Int?
  userId           Int
  statusId         Int
  createdAt        DateTime         @default(now())
  status           AttendanceStatus @relation(fields: [statusId], references: [id])
  user             User             @relation(fields: [userId], references: [id])

  @@unique([userId, date])
}

model ActivityType {
  id         Int        @id @default(autoincrement())
  name       String     @unique
  activities Activity[]
}

model Activity {
  id          Int          @id @default(autoincrement())
  name        String
  description String?
  date        DateTime
  startTime   DateTime
  endTime     DateTime
  userId      Int
  typeId      Int
  createdAt   DateTime     @default(now())
  type        ActivityType @relation(fields: [typeId], references: [id])
  user        User         @relation(fields: [userId], references: [id])
}

model AdminAction {
  id        Int      @id @default(autoincrement())
  action    String
  createdAt DateTime @default(now())
  note      String?
  adminId   Int
  admin     User     @relation(fields: [adminId], references: [id])
}
model Holiday {
  id        Int      @id @default(autoincrement())
  date      DateTime // (date-only koncept)
  name      String   
  country   String   // "RS"
  source    String   // "nager"
  createdAt DateTime @default(now())

  @@unique([date, country, name])
  @@index([date, country])
}
model WeatherDaily {
  id           Int      @id @default(autoincrement())
  locationKey  String
  date         DateTime 
  tempMax      Float?
  tempMin      Float?
  precipSum    Float?
  windMax      Float?
  weatherCode  Int?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([locationKey, date])
  @@index([date])
}

enum WfhRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

model WfhRequest {
  id          Int              @id @default(autoincrement())
  userId      Int
  date        DateTime         
  status      WfhRequestStatus @default(PENDING)

  reason      String?          // optional poruka zaposlenog
  createdAt   DateTime         @default(now())
  decidedAt   DateTime?
  decidedById Int?

  // snapshot vremena (da kasnije ima smisla ako se forecast promeni)
  weatherCode Int?
  precipSum   Float?
  windMax     Float?

  user      User  @relation("WfhRequests", fields: [userId], references: [id])
 decidedBy User? @relation("WfhDecisions", fields: [decidedById], references: [id])

  @@unique([userId, date], name: "user_date_unique")
  @@index([date])
  @@index([status])
}


